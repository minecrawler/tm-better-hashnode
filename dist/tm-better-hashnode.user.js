/**
 * // ==UserScript==
 * // @name         tm-better-hashnode
 * // @namespace    https://hashnode.com
 * // @version      0.2.1
 * // @description  Improve the Hashnode experience according to @maruru
 * // @author       Marco Alka
 * // @match        https://hashnode.com/*
 * // @source       https://github.com/minecrawler/tm-better-hashnode
 * // @updateURL    https://github.com/minecrawler/tm-better-hashnode/raw/master/dist/tm-better-hashnode.user.js
 * // @grant        GM_addStyle
 * // ==/UserScript==
 */

'use strict';(function(){function k(a,b){f.appendChild(document.createTextNode(`[${a}]: ${b}`));f.appendChild(document.createElement("br"))}GM_addStyle(".action-nav .hiring-link{border-radius:1000px;line-height:1.5;font-size:1rem;padding:.375rem .75rem}.post-card.status-card:first-child,.widget.lets-write{display:none!important}.c-chat{position:absolute;right:0;bottom:0;margin-bottom:-250px;height:250px;width:500px;transition-timing-function:ease-in-out;transition-duration:.3s;transition-property:margin-bottom}.o-chat-visible.c-chat{margin-bottom:0}.c-chat__container{position:fixed;z-index:1000;right:0;top:0;height:100%}.c-chat__input{width:calc(100% - 100px)}.c-chat__input[disabled]{cursor:not-allowed}.c-chat__input-row{display:flex;flex-direction:row}.c-chat__submit{width:100px;height:30px;margin:0;cursor:pointer}.c-chat__submit[disabled]{cursor:not-allowed}.c-chat__messages{height:calc(100% - 30px);overflow:hidden;word-wrap:break-word;overflow-y:scroll}.c-chat__user-list{height:100%;width:200px;margin-right:-200px;transition-timing-function:ease-in-out;transition-duration:.3s;transition-property:margin-right,height}.o-chat-visible.c-chat__user-list{margin-right:0;height:calc(100% - 250px)}.o-chat-user-list__display-name{display:block}.c-chat-user-list__heading{font-size:1.5em;padding:1em 15px;margin:0}.o-chat-user-list__user{margin-bottom:5px;border-top:1px solid #777}.c-chat-user-list__users{list-style:none;padding-left:25px}.c-chat__visibility-btn{position:absolute;bottom:0;right:0;height:2em;width:100px;cursor:pointer;transition-timing-function:ease-in-out;transition-duration:.3s;transition-property:margin-bottom,margin-right,background-color}.o-chat-visible.c-chat__visibility-btn{margin-bottom:250px;margin-right:200px}.o-chat-user-list__username{display:block;font-size:.75em;margin-top:-5px;padding-left:10px}.t-light .c-chat{border-left:1px solid #000;border-top:1px solid #000;background-color:#fff;padding:6px 10px;transition-timing-function:ease-in-out;transition-duration:.3s;transition-property:margin}.t-light .c-chat__input{border:none}.t-light .c-chat__messages{border-bottom:1px solid #ccc}.t-light .c-chat__submit{border:0}.t-light .c-chat__submit{color:#fff;background-color:#28a745;transition-timing-function:ease-in-out;transition-duration:.3s;transition-property:background-color}.t-light .c-chat__submit:hover{background-color:#27a56c}.t-light .c-chat__user-list{background-color:#fff;border-left:1px solid #000}.t-light .c-chat__visibility-btn{border:none;padding:1px 6px;color:#fff;background-color:#2fc681}.t-light .c-chat__visibility-btn:hover{background-color:#1e7e34}.t-light .o-chat-user-list__username{color:#777}");
var p={callRESTEndpoint(a){return new Promise((b,d)=>{const c=new XMLHttpRequest;c.open("GET","/ajax"+("/"===a.charAt(0)?a:"/"+a));c.onerror=(a)=>{d({error:a,response:c.response,status:c.status})};c.ontimeout=()=>{d({error:Error("Timeout exceeded"),response:c.response,status:c.status})};c.onload=()=>{200<=c.status&&300>c.status?b(c.response):400<=c.status&&d({error:Error(`HTTP Error (${c.status})`),response:c.response,status:c.status})};c.send()})}},l={getCurrentUser(){const a=document.querySelector(".profile-name");
return{displayName:a.innerText,username:a.href.toString().match(/\/@(.+)$/i)[1]}},getUserInfo(a){return new Promise((b,d)=>{p.callRESTEndpoint("profile/"+a).catch(d).then((a)=>b(JSON.parse(a).profile))})}};const q=document.querySelector("body"),b=document.createElement("div"),r=l.getCurrentUser().username;b.classList.add("c-chat__container");b.classList.add("t-light");b.innerHTML='\x3cbutton class\x3d"c-chat__visibility-btn / js-chat__visibility-btn"\x3eShow Chat\x3c/button\x3e \x3cdiv class\x3d"c-chat__user-list / js-chat__user-list"\x3e \x3cp class\x3d"c-chat-user-list__heading"\x3eOnline Users\x3c/p\x3e \x3cul class\x3d"c-chat-user-list__users / js-chat-user-list__users"\x3e\x3c/ul\x3e \x3c/div\x3e \x3cdiv class\x3d"c-chat / js-chat"\x3e \x3cdiv class\x3d"c-chat__messages / js-chat__messages"\x3e\x3c/div\x3e \x3cdiv class\x3d"c-chat__input-row"\x3e \x3cinput type\x3d"text" maxlength\x3d"140" class\x3d"c-chat__input / js-chat__input" placeholder\x3d"Write a message"\x3e \x3cbutton type\x3d"submit" class\x3d"c-chat__submit / js-chat__submit"\x3eSend\x3c/button\x3e \x3c/div\x3e \x3c/div\x3e ';
q.appendChild(b);const g=b.querySelector(".js-chat__visibility-btn"),d=b.querySelector(".js-chat__input"),f=b.querySelector(".js-chat__messages"),m=b.querySelector(".js-chat__submit"),n=[b.querySelector(".js-chat"),b.querySelector(".js-chat__user-list"),b.querySelector(".js-chat__visibility-btn")];g.addEventListener("click",()=>{g.classList.contains("o-chat-visible")?(g.innerText="Show Chat",n.forEach((a)=>a.classList.remove("o-chat-visible"))):(g.innerText="Hide Chat",n.forEach((a)=>a.classList.add("o-chat-visible")))});
const e=new WebSocket("wss://localhost:1288");e.addEventListener("open",()=>{k("System","Connected to chat server")});e.addEventListener("message",(a)=>{a=JSON.parse(a.data);k(a.author,a.message)});m.addEventListener("click",()=>{""!==d.value&&(3<e.readyState&&e.send(`{"author":"${r}","message":"${d.value}"}`),d.value="",d.focus(),f.scrollTop=f.scrollHeight)});setTimeout(()=>{3===e.readyState&&(d.setAttribute("disabled",""),m.setAttribute("disabled",""),m.innerText="Working",k("System","Could not connect to chat server"))},
2E3);setTimeout(function(){document.querySelectorAll(".community-power.widget").forEach((a)=>a.parentNode.removeChild(a))},5E3);const h=l.getCurrentUser().username;l.getUserInfo(h).catch(()=>{}).then((a)=>{document.querySelector(`div.score-wrap \x3e a[href\x3d"/@${h}"] \x3e p.big`).innerText=a.totalUpvotesReceived;document.querySelector(`div.score-wrap \x3e a[href\x3d"/@${h}/followers"] \x3e p.big`).innerText=a.numFollowers;document.querySelector(`div.score-wrap \x3e a[href\x3d"/@${h}/following"] \x3e p.big`).innerText=
a.numFollowing})})();
